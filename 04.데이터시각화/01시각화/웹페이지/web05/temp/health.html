<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공공의료기관현황</title>
    <style>
        * {
            font-family: "Jua", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        th,td{
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container m-5">
        <h1 class="text-center mb-3">공공의료기관현황</h1>
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <form class="mb-2" name="frm">
                    <div class="input group">
                        <input class="form-control" placeholder="검색어">
                        <button class="btn btn-primary" id="buttons">검색</button>
                    </div>
                </form>
            </div>
            <div id="health"></div>
            </div>
        </div>
        <div class="text-center">
            <button class="btn btn-primary px-5" id="prev">이전</button>
            <span class="px-3" id="page">1/10</span>
            <button class="btn btn-primary px-5" id="next">다음</button>
        </div>
        <div class="my-3">
            <img src="" id="image" style="display:none;" width="100%">
        </div>
    </div>
</body>
<script> // 동작 구역
    let page=1; //초기값
    let size=5;

    $(frm).on("submit",function(e){
        e.preventDefault(); //default 이벤트를 
        page=1;
        getData();
    })

    $("#next").on("click",function(){
        page++; //증가연산자
        getData();
    });

      $("#prev").on("click",function(){
        if(page>1){
        page--; //감소연산자
        getData();
        }
    });

    getData();
    function getData(){// 데이터를 가져오는 함수
        const word = $(frm.word).val();
        $.ajax({
            type:"get",
            url:"/health/data",
            data:{"page":page, "size":size, 'word':word},
            success:function(data){
                $("#health").html(data.table);
                const count=data.count;
                const last=Math.ceil(count/size);
                $("#page").html(`${page}/${last}`);

                if(page==1)$("#prev").attr("disabled",true);
                else$("#prev").attr("disabled",false);

                if(page==last)$("#next").attr("disabled",true);
                else$("#next").attr("disabled",false);
                if(count==0) $("#buttons").hide();
                else $("#buttons").show();

                if(count>0){
                    $("#image").show();
                    $("#image").attr("src", "/health/graph?word=" + word);
                }
            }
        })
    }
</script>
</html>